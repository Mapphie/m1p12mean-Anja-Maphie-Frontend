<div class="container">
    <form (ngSubmit)="onSubmit()" #invoiceForm="ngForm">
      <div class="card">
        <div class="card-header">
          <h1 class="card-title">Cr√©er une nouvelle facture</h1>
        </div>
        <div class="card-content">
          <div class="form-section">
            <h2>Informations de la facture</h2>
            <div class="form-grid">
              <div class="form-group">
                <label for="invoice-number">Num√©ro de facture</label>
                <input 
                  type="text" 
                  id="invoice-number" 
                  name="invoiceNumber"
                  [(ngModel)]="invoice.invoiceNumber" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="invoice-date">Date</label>
                <input 
                  type="text" 
                  id="invoice-date" 
                  name="date"
                  [(ngModel)]="invoice.issueDate" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="payment-due-date">Limite de paiement</label>
                <input 
                  type="text" 
                  id="payment-due-date" 
                  name="paymentDueDate"
                  [(ngModel)]="invoice.dueDate" 
                  required
                >
              </div>
            </div>
          </div>
  
          <div class="form-section">
            <h2>Client</h2>
            <div class="form-group">
              <label for="client">S√©lectionner un client</label>
              <select 
                id="client" 
                name="client"
                [(ngModel)]="selectedClient"
                (change)="onClientChange()"
                required
              >
                <option value="">-- S√©lectionner un client --</option>
                <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
              </select>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label for="client-name">Nom du client</label>
                <input 
                  type="text" 
                  id="client-name" 
                  name="clientName"
                  [(ngModel)]="invoice.clientName" 
                  required
                >
              </div>
              
              <div class="form-group">
                <label for="client-address">Adresse</label>
                <input 
                  type="text" 
                  id="client-address" 
                  name="clientAddress"
                  [(ngModel)]="invoice.clientAddress" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="client-phone">T√©l√©phone</label>
                <input 
                  type="text" 
                  id="client-phone" 
                  name="clientPhone"
                  [(ngModel)]="invoice.clientPhone" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="client-email">Email</label>
                <input 
                  type="email" 
                  id="client-email" 
                  name="clientEmail"
                  [(ngModel)]="invoice.clientEmail" 
                  required
                >
              </div>
            </div>
          </div>
  
          <div class="form-section">
            <h2>Informations du v√©hicule</h2>
            <div class="form-grid">
              <div class="form-group">
                <label for="registration">Immatriculation</label>
                <input 
                  type="text" 
                  id="registration" 
                  name="registration"
                  [(ngModel)]="vehicleInfo.registration" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="brand">Marque</label>
                <input 
                  type="text" 
                  id="brand" 
                  name="brand"
                  [(ngModel)]="vehicleInfo.brand" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="model">Mod√®le</label>
                <input 
                  type="text" 
                  id="model" 
                  name="model"
                  [(ngModel)]="vehicleInfo.model" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="serial-number">N¬∞ s√©rie</label>
                <input 
                  type="text" 
                  id="serial-number" 
                  name="serialNumber"
                  [(ngModel)]="vehicleInfo.serialNumber" 
                  required
                >
              </div>
              <div class="form-group">
                <label for="mileage">Kilom√©trage</label>
                <input 
                  type="text" 
                  id="mileage" 
                  name="mileage"
                  [(ngModel)]="vehicleInfo.mileage" 
                  required
                >
              </div>
            </div>
          </div>
  
          <div class="form-section">
            <h2>Articles</h2>
            
            <div class="items-header">
              <div class="item-col reference">R√©f√©rence</div>
              <div class="item-col designation">D√©signation</div>
              <div class="item-col price">Prix u HT</div>
              <div class="item-col quantity">Qt√©</div>
              <div class="item-col total">Total HT</div>
              <div class="item-col actions">Actions</div>
            </div>
            
            <div class="item-row" *ngFor="let item of invoice.items; let i = index">
              <div class="item-col reference">
                
              </div>
              <div class="item-col designation">
                <input 
                  type="text" 
                  [name]="'item-desc-' + i" 
                  [(ngModel)]="item.designation" 
                  placeholder="D√©signation" 
                  required
                >
              </div>
              <div class="item-col price">
                <input 
                  type="number" 
                  [name]="'item-price-' + i" 
                  [(ngModel)]="item.price" 
                  min="0" 
                  step="0.01" 
                  (change)="updateItemTotal(item)" 
                  required
                >
              </div>
              <div class="item-col quantity">
                <input 
                  type="number" 
                  [name]="'item-qty-' + i" 
                  [(ngModel)]="item.quantity" 
                  min="0.5" 
                  step="0.5" 
                  (change)="updateItemTotal(item)" 
                  required
                >
              </div>
              <div class="item-col total">
                <input 
                  type="text" 
                  [name]="'item-total-' + i" 
                  [value]="item.amount.toFixed(2) + ' ‚Ç¨'" 
                  readonly
                >
              </div>
              <div class="item-col actions">
                <button 
                  type="button" 
                  class="btn btn-icon" 
                  (click)="removeItem(i)" 
                  [disabled]="invoice.items.length === 1"
                >
                  <span class="icon">üóëÔ∏è</span>
                </button>
              </div>
            </div>
            
            <button type="button" class="btn btn-outline" (click)="addItem()">
              <span class="icon">+</span> Ajouter un article
            </button>
            
            <div class="totals-section">
              <div class="total-row">
                <span>Total HT:</span>
                <span>{{ invoice.totalHT?.toFixed(2) }} ‚Ç¨</span>
              </div>
              <div class="total-row">
                <span>TVA (20%):</span>
                <span>{{ invoice.tva?.toFixed(2) }} ‚Ç¨</span>
              </div>
              <div class="total-row total">
                <span>Total TTC:</span>
                <span>{{ invoice.totalTTC?.toFixed(2) }} ‚Ç¨</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <button type="button" class="btn btn-outline" (click)="cancel()">
            Annuler
          </button>
          <button type="submit" class="btn btn-primary">
            Cr√©er la facture
          </button>
        </div>
      </div>
    </form>
  </div>
  
  